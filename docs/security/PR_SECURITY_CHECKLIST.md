# PRセキュリティレビューチェックリスト

**エス・エー・エス株式会社**  
*最終更新日: 2025年9月10日*  
*バージョン: 1.0.0*

## 📋 概要

このチェックリストは、プルリクエスト（PR）レビュー時に確認すべきセキュリティ項目を網羅的にまとめたものです。
レビュアーは、コードの機能面だけでなく、セキュリティ観点からも徹底的にレビューを行ってください。

## 🎯 リスクレベル定義

| レベル | 定義 | 対応期限 | 影響範囲 |
|--------|------|----------|----------|
| **Critical** | 即座に悪用可能な重大な脆弱性 | 即座（4時間以内） | システム全体・データ漏洩 |
| **High** | 悪用可能な脆弱性 | 当日中（8時間以内） | 重要機能・機密データ |
| **Medium** | 限定的な条件下で悪用可能 | 3営業日以内 | 特定機能・非機密データ |
| **Low** | 直接的な脅威ではないが改善が必要 | 次回リリースまで | 限定的・将来的リスク |

---

## 🔐 OWASP Top 10 セキュリティチェック

### 1. インジェクション攻撃対策

#### SQLインジェクション
- [ ] **[Critical]** パラメータ化クエリ/プリペアドステートメントを使用しているか
- [ ] **[Critical]** 動的SQLの構築を避けているか
- [ ] **[High]** ORMを適切に使用しているか
- [ ] **[High]** ストアドプロシージャの入力値を検証しているか
- [ ] **[Medium]** データベースエラーメッセージが外部に漏れないか

#### NoSQLインジェクション
- [ ] **[Critical]** MongoDBのクエリオペレータ（$where、$regex等）を安全に使用しているか
- [ ] **[High]** 入力値の型チェックを実施しているか
- [ ] **[High]** JSONオブジェクトの直接パースを避けているか

#### OSコマンドインジェクション
- [ ] **[Critical]** システムコマンドの実行を避けているか
- [ ] **[Critical]** 必要な場合、ホワイトリスト方式で入力を制限しているか
- [ ] **[High]** シェルエスケープ処理を適切に行っているか

#### LDAPインジェクション
- [ ] **[High]** LDAP検索時の入力値をエスケープしているか
- [ ] **[Medium]** バインド変数を使用しているか

### 2. 認証の不備

#### パスワード管理
- [ ] **[Critical]** パスワードは適切にハッシュ化されているか（bcrypt、scrypt、Argon2）
- [ ] **[High]** パスワード強度の要件を満たしているか（最小12文字、複雑性要件）
- [ ] **[High]** パスワードリセット機能は安全か（トークンの有効期限、一回限り使用）
- [ ] **[Medium]** パスワード履歴チェックを実装しているか
- [ ] **[Low]** パスワード変更時に通知を送信しているか

#### 多要素認証（MFA）
- [ ] **[High]** 重要な操作にMFAを要求しているか
- [ ] **[High]** TOTP/HOTP実装は標準準拠か（RFC 6238/4226）
- [ ] **[Medium]** バックアップコードの管理は適切か
- [ ] **[Medium]** MFAバイパス条件は適切に制限されているか

#### セッション管理
- [ ] **[Critical]** セッションIDは予測不可能か（128ビット以上のエントロピー）
- [ ] **[High]** セッションタイムアウトを実装しているか（アイドル：15分、絶対：8時間）
- [ ] **[High]** ログアウト時にセッションを完全に無効化しているか
- [ ] **[High]** セッション固定攻撃対策を実装しているか
- [ ] **[Medium]** 並行セッション数を制限しているか
- [ ] **[Medium]** セッションIDをURLに含めていないか

### 3. 機密データ露出

#### データ暗号化
- [ ] **[Critical]** 機密データは保存時に暗号化されているか（AES-256以上）
- [ ] **[Critical]** 転送時にTLS 1.2以上を使用しているか
- [ ] **[High]** 暗号鍵は安全に管理されているか（KMS、HSM使用）
- [ ] **[High]** 暗号化アルゴリズムは最新の推奨事項に準拠しているか
- [ ] **[Medium]** 暗号鍵のローテーションを実装しているか

#### 個人情報（PII）保護
- [ ] **[Critical]** 個人情報の収集は最小限か
- [ ] **[High]** 個人情報へのアクセスは必要最小限に制限されているか
- [ ] **[High]** データマスキング/匿名化を適切に実装しているか
- [ ] **[Medium]** データ保持期間ポリシーに準拠しているか
- [ ] **[Medium]** データ削除要求に対応できるか（GDPR対応）

#### ログ管理
- [ ] **[Critical]** パスワード、トークン、APIキーがログに記録されていないか
- [ ] **[High]** クレジットカード番号、社会保障番号等がマスクされているか
- [ ] **[High]** ログへのアクセスは制限されているか
- [ ] **[Medium]** ログの改ざん防止対策があるか

### 4. XML外部エンティティ（XXE）

- [ ] **[High]** XMLパーサーで外部エンティティを無効化しているか
- [ ] **[High]** DTD処理を無効化しているか
- [ ] **[Medium]** XMLスキーマ検証を実装しているか
- [ ] **[Medium]** SAMLアサーションの検証は適切か

### 5. アクセス制御の不備

#### 認可チェック
- [ ] **[Critical]** すべてのAPIエンドポイントで認可チェックを実施しているか
- [ ] **[Critical]** 水平的権限昇格（他ユーザーのデータへのアクセス）を防いでいるか
- [ ] **[Critical]** 垂直的権限昇格（管理者機能へのアクセス）を防いでいるか
- [ ] **[High]** デフォルトで拒否の原則を適用しているか
- [ ] **[High]** RBAC/ABACを適切に実装しているか

#### CORS設定
- [ ] **[High]** Access-Control-Allow-Originは適切に設定されているか
- [ ] **[High]** ワイルドカード（*）の使用を避けているか
- [ ] **[Medium]** 認証情報付きリクエストの設定は適切か

### 6. セキュリティ設定の不備

#### セキュリティヘッダー
- [ ] **[High]** Content-Security-Policy（CSP）が設定されているか
- [ ] **[High]** X-Frame-Options（クリックジャッキング対策）が設定されているか
- [ ] **[High]** X-Content-Type-Options: nosniffが設定されているか
- [ ] **[Medium]** Strict-Transport-Security（HSTS）が設定されているか
- [ ] **[Medium]** Referrer-Policyが適切に設定されているか

#### エラーハンドリング
- [ ] **[High]** スタックトレースが本番環境で表示されないか
- [ ] **[High]** デバッグ情報が無効化されているか
- [ ] **[Medium]** カスタムエラーページを使用しているか
- [ ] **[Medium]** エラーレスポンスから情報漏洩がないか

### 7. クロスサイトスクリプティング（XSS）

#### 出力エンコーディング
- [ ] **[Critical]** HTMLコンテキストでの出力エスケープを実施しているか
- [ ] **[Critical]** JavaScriptコンテキストでの出力エスケープを実施しているか
- [ ] **[High]** CSSコンテキストでの出力エスケープを実施しているか
- [ ] **[High]** URLコンテキストでの出力エスケープを実施しているか
- [ ] **[High]** 属性値での出力エスケープを実施しているか

#### DOM XSS対策
- [ ] **[High]** innerHTML、document.writeの使用を避けているか
- [ ] **[High]** eval()、setTimeout()、setInterval()への動的入力を避けているか
- [ ] **[Medium]** DOMPurifyなどのサニタイザーを使用しているか

### 8. 安全でないデシリアライゼーション

- [ ] **[Critical]** 信頼できないソースからのシリアライズデータを避けているか
- [ ] **[High]** デシリアライゼーション時の型チェックを実施しているか
- [ ] **[High]** JSONスキーマ検証を実装しているか
- [ ] **[Medium]** デシリアライゼーションライブラリは最新か

### 9. 既知の脆弱性を持つコンポーネント

#### 依存関係管理
- [ ] **[High]** 依存関係の脆弱性スキャンを実施しているか
- [ ] **[High]** 重大な脆弱性（CVSS 7.0以上）が存在しないか
- [ ] **[Medium]** 依存関係は最新バージョンか
- [ ] **[Medium]** 不要な依存関係を削除しているか
- [ ] **[Low]** ライセンス互換性の問題はないか

### 10. 不十分なログ記録・監視

#### セキュリティログ
- [ ] **[High]** 認証の成功/失敗をログに記録しているか
- [ ] **[High]** 認可エラーをログに記録しているか
- [ ] **[High]** 入力検証エラーをログに記録しているか
- [ ] **[Medium]** 重要なトランザクションをログに記録しているか
- [ ] **[Medium]** ログの相関分析が可能か（トレースID等）

---

## 🔒 認証・認可の詳細チェック

### OAuth 2.0 / OpenID Connect

- [ ] **[Critical]** state パラメータでCSRF対策を実施しているか
- [ ] **[High]** PKCEを実装しているか（パブリッククライアント）
- [ ] **[High]** リダイレクトURIの検証は厳密か
- [ ] **[High]** アクセストークンの有効期限は適切か（1時間以内）
- [ ] **[Medium]** リフレッシュトークンのローテーションを実装しているか
- [ ] **[Medium]** スコープの最小権限原則を適用しているか

### JWT実装

- [ ] **[Critical]** algorithm: noneを拒否しているか
- [ ] **[High]** 署名検証を適切に実施しているか
- [ ] **[High]** 公開鍵の取得元（JWKS）は信頼できるか
- [ ] **[Medium]** JWTの有効期限（exp）を検証しているか
- [ ] **[Medium]** JWTのサイズが適切か（8KB以内）

### API認証

- [ ] **[High]** APIキーは環境変数/シークレット管理で保管しているか
- [ ] **[High]** APIキーのローテーションが可能か
- [ ] **[Medium]** レート制限を実装しているか
- [ ] **[Medium]** APIキーのスコープは最小限か

---

## 🛡️ データ保護とプライバシー

### GDPR/個人情報保護法準拠

- [ ] **[Critical]** 同意取得メカニズムを実装しているか
- [ ] **[High]** データポータビリティ（エクスポート）機能があるか
- [ ] **[High]** 忘れられる権利（削除）機能があるか
- [ ] **[High]** プライバシーポリシーへのリンクがあるか
- [ ] **[Medium]** データ処理の法的根拠を明示しているか
- [ ] **[Medium]** 第三者提供の通知があるか

### データ最小化

- [ ] **[High]** 収集するデータは必要最小限か
- [ ] **[High]** 不要になったデータを削除しているか
- [ ] **[Medium]** データの利用目的を明確にしているか
- [ ] **[Medium]** データ保持期間を定義しているか

---

## 🌐 インフラ・ネットワークセキュリティ

### HTTPS/TLS設定

- [ ] **[Critical]** HTTPSを強制しているか
- [ ] **[High]** TLS 1.2以上のみを許可しているか
- [ ] **[High]** 弱い暗号スイートを無効化しているか
- [ ] **[Medium]** 証明書のピンニングを実装しているか（モバイルアプリ）
- [ ] **[Medium]** 証明書の有効期限監視があるか

### DDoS/レート制限

- [ ] **[High]** APIエンドポイントにレート制限があるか
- [ ] **[High]** ログイン試行回数を制限しているか
- [ ] **[Medium]** IPベースの制限を実装しているか
- [ ] **[Medium]** CAPTCHAを適切に使用しているか

### CSRFトークン

- [ ] **[High]** 状態変更操作にCSRFトークンを要求しているか
- [ ] **[High]** CSRFトークンは予測不可能か
- [ ] **[Medium]** SameSite Cookieを使用しているか
- [ ] **[Medium]** Double Submit Cookieパターンを実装しているか

---

## 🔧 コード品質とセキュアコーディング

### 入力検証

- [ ] **[Critical]** すべての入力に対してホワイトリスト検証を実施しているか
- [ ] **[High]** ファイルアップロードの検証（タイプ、サイズ、内容）を実施しているか
- [ ] **[High]** 正規表現のReDoS脆弱性がないか
- [ ] **[Medium]** 入力長の制限を実施しているか
- [ ] **[Medium]** 文字エンコーディングを統一しているか（UTF-8）

### エラー処理

- [ ] **[High]** すべての例外を適切にキャッチしているか
- [ ] **[High]** リソースの適切なクリーンアップを実施しているか
- [ ] **[Medium]** タイムアウト処理を実装しているか
- [ ] **[Medium]** リトライロジックは適切か

### 暗号化実装

- [ ] **[Critical]** 自作暗号を使用していないか
- [ ] **[High]** 暗号学的に安全な乱数生成器を使用しているか
- [ ] **[High]** ソルトは一意で十分な長さか（32バイト以上）
- [ ] **[Medium]** IVは予測不可能か
- [ ] **[Medium]** 暗号化モードは適切か（GCM、CBC+HMAC）

---

## 📊 クラウド環境固有のセキュリティ

### AWS

- [ ] **[High]** S3バケットは非公開か
- [ ] **[High]** IAMロールは最小権限か
- [ ] **[High]** Secrets Managerを使用しているか
- [ ] **[Medium]** CloudTrailログを有効化しているか
- [ ] **[Medium]** VPCセキュリティグループは適切か

### Azure

- [ ] **[High]** Key Vaultを使用しているか
- [ ] **[High]** Managed Identityを使用しているか
- [ ] **[Medium]** Network Security Groupsは適切か
- [ ] **[Medium]** Azure Monitorを設定しているか

### GCP

- [ ] **[High]** Secret Managerを使用しているか
- [ ] **[High]** Service Accountの権限は最小限か
- [ ] **[Medium]** VPCファイアウォールルールは適切か
- [ ] **[Medium]** Cloud Loggingを有効化しているか

---

## 🐳 コンテナ・Kubernetesセキュリティ

### Dockerイメージ

- [ ] **[High]** ベースイメージは信頼できるソースか
- [ ] **[High]** 最小限のベースイメージを使用しているか（Alpine等）
- [ ] **[High]** ROOTユーザーで実行していないか
- [ ] **[Medium]** 不要なパッケージを削除しているか
- [ ] **[Medium]** イメージスキャンを実施しているか

### Kubernetes

- [ ] **[High]** Pod Security Policiesを適用しているか
- [ ] **[High]** Network Policiesを設定しているか
- [ ] **[High]** Secretsは暗号化されているか
- [ ] **[Medium]** Resource Limitsを設定しているか
- [ ] **[Medium]** SecurityContextを適切に設定しているか

---

## 📝 コンプライアンスチェック

### PCI-DSS（カード情報を扱う場合）

- [ ] **[Critical]** カード番号を平文で保存していないか
- [ ] **[Critical]** CVVを保存していないか
- [ ] **[High]** カード番号のマスキングを実施しているか
- [ ] **[High]** トークナイゼーションを使用しているか

### HIPAA（医療情報を扱う場合）

- [ ] **[Critical]** PHIへのアクセスログを記録しているか
- [ ] **[High]** データの暗号化を実施しているか
- [ ] **[High]** アクセス制御を実装しているか
- [ ] **[Medium]** 監査ログを保持しているか

---

## ✅ レビュー完了チェック

### 最終確認項目

- [ ] すべてのCriticalリスク項目が対処されているか
- [ ] すべてのHighリスク項目が対処または軽減計画があるか
- [ ] セキュリティテストの実施計画があるか
- [ ] デプロイ前のセキュリティスキャンが設定されているか
- [ ] インシデント対応手順が明確か

### レビュー承認

| 項目 | チェック | 承認者 | 日時 |
|------|---------|--------|------|
| コードレビュー完了 | [ ] | | |
| セキュリティレビュー完了 | [ ] | | |
| 自動テスト合格 | [ ] | | |
| セキュリティスキャン合格 | [ ] | | |
| 最終承認 | [ ] | | |

---

## 📚 参考資料

- [OWASP Top 10 2021](https://owasp.org/Top10/)
- [OWASP ASVS 4.0](https://owasp.org/www-project-application-security-verification-standard/)
- [OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/)
- [NIST Cybersecurity Framework](https://www.nist.gov/cyberframework)
- [CIS Controls](https://www.cisecurity.org/controls)

---

**© 2025 エス・エー・エス株式会社 - PRセキュリティレビューチェックリスト**