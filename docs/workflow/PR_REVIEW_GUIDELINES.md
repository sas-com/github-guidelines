# プルリクエスト運用ガイドライン

**エス・エー・エス株式会社**  
*包括的なPRレビュープロセスガイド*

## 📋 概要

このドキュメントは、エス・エー・エス株式会社のすべてのプロジェクトで使用するプルリクエストの運用ガイドラインを定義します。品質保証、セキュリティ、効率的なレビュープロセスを実現することを目的としています。

## 🎯 PRレビューの目的

### 品質保証
- コード品質の向上
- バグの早期発見・修正
- 設計思想の統一
- パフォーマンスの最適化

### 知識共有
- チーム内での技術共有
- ベストプラクティスの普及
- 新しい技術・手法の学習
- 属人化の防止

### セキュリティ
- セキュリティ脆弱性の検出
- 機密情報漏洩の防止
- アクセス制御の適切性確認
- OWASP準拠のセキュリティチェック

## 🏷️ PRタイプ分類

### Feature PR（機能追加）
```
feat(scope): 新機能の実装

- 新しいビジネス機能の追加
- 既存機能の拡張
- API エンドポイントの追加
```

### Bugfix PR（バグ修正）
```
fix(scope): バグ修正

- 既存機能の不具合修正
- パフォーマンス問題の解決
- セキュリティ脆弱性の修正
```

### Hotfix PR（緊急修正）
```
hotfix(scope): 緊急修正

- 本番環境の緊急障害対応
- セキュリティインシデント対応
- データ整合性問題の修正
```

### Refactoring PR（リファクタリング）
```
refactor(scope): コード改善

- 機能変更を伴わないコード整理
- アーキテクチャ改善
- 技術的負債の解消
```

## 📝 PRテンプレート構造

### 基本テンプレート
```markdown
## 📋 変更概要
<!-- 何を変更したかを簡潔に説明 -->

## 🎯 変更理由
<!-- なぜこの変更が必要かを説明 -->

## 📊 変更詳細
### 追加された機能
- [ ] 機能A：詳細説明
- [ ] 機能B：詳細説明

### 修正されたバグ
- [ ] バグA：修正内容
- [ ] バグB：修正内容

### 変更されたファイル
- `path/to/file1.js` - 変更内容の説明
- `path/to/file2.ts` - 変更内容の説明

## 🧪 テスト
### テスト実施状況
- [ ] ユニットテスト実施・通過
- [ ] 統合テスト実施・通過
- [ ] E2Eテスト実施・通過
- [ ] 手動テスト実施・通過

### 新規テストの追加
- [ ] ユニットテスト追加
- [ ] 統合テスト追加
- [ ] テストカバレッジ: ○○%

### テストケース
```
1. 正常系テスト
   - 入力: 〜
   - 期待結果: 〜

2. 異常系テスト
   - 入力: 〜
   - 期待結果: 〜
```

## 🔒 セキュリティチェック
### セキュリティ確認事項
- [ ] 機密情報の漏洩がないか確認
- [ ] 入力値検証が適切に実装されているか
- [ ] アクセス制御が正しく設定されているか
- [ ] SQLインジェクション対策が実装されているか
- [ ] XSS対策が実装されているか
- [ ] CSRF対策が実装されているか

### セキュリティスキャン結果
- [ ] 静的解析ツール: PASS
- [ ] 依存関係脆弱性チェック: PASS
- [ ] シークレット検出: PASS

## 📈 パフォーマンス影響
### パフォーマンステスト結果
- [ ] 負荷テスト実施
- [ ] レスポンス時間: 変更前 ○○ms → 変更後 ○○ms
- [ ] メモリ使用量: 変更前 ○○MB → 変更後 ○○MB
- [ ] CPU使用率: 変更前 ○○% → 変更後 ○○%

### パフォーマンス最適化
- [ ] データベースクエリの最適化
- [ ] キャッシュ戦略の改善
- [ ] アルゴリズムの効率化

## 🔍 レビューポイント
### 特に注目して確認してほしい箇所
1. `path/to/critical/file.js:123-145` - 複雑なロジック実装
2. `path/to/security/file.ts:67-89` - セキュリティ関連処理

### 既知の制約・注意事項
- 制約A: 詳細説明
- 制約B: 詳細説明

## 📚 関連情報
### 関連Issue・PR
- Closes #123
- Relates to #456
- Depends on #789

### 参考資料
- [設計ドキュメント](link)
- [API仕様書](link)
- [テスト結果詳細](link)

### 影響を受ける機能
- 機能A：影響内容
- 機能B：影響内容

## 🚀 デプロイ・リリース
### デプロイ手順
- [ ] データベースマイグレーション必要
- [ ] 設定ファイル更新必要
- [ ] 環境変数追加・更新必要
- [ ] サードパーティサービス設定変更必要

### リリース後確認事項
- [ ] 機能A の動作確認
- [ ] 機能B の動作確認
- [ ] エラーログ監視
- [ ] パフォーマンス監視

### ロールバック準備
- [ ] ロールバック手順書作成
- [ ] データバックアップ実施
- [ ] 緊急連絡先確認

## ✅ 事前チェックリスト（作成者向け）
- [ ] コミット規約に準拠しているか
- [ ] 機密情報が含まれていないか
- [ ] テストが通っているか
- [ ] ドキュメント更新が必要か
- [ ] Breaking Changes はないか
- [ ] 設定ファイル変更の文書化
```

## 👥 レビュアー指定ガイドライン

### 必須レビュアー
| PR種類 | 必須レビュアー | 理由 |
|--------|----------------|------|
| Security関連 | セキュリティチーム | セキュリティ専門知識が必要 |
| API変更 | テックリード + QA | 設計レビューとテスト戦略確認 |
| インフラ変更 | インフラチーム | 運用影響の評価が必要 |
| UI/UX変更 | デザイナー | デザイン仕様との整合性確認 |

### 推奨レビュアー
- **機能領域の専門家**: 該当機能の詳しいメンバー
- **新人・中堅**: 知識共有とメンタリング目的
- **他チームメンバー**: 横断的な知見の共有

### レビュアー数の基準
| PR規模 | 変更行数 | 推奨レビュアー数 |
|--------|----------|------------------|
| 小 | ～50行 | 1人以上 |
| 中 | 51～200行 | 2人以上 |
| 大 | 201～500行 | 3人以上 |
| 特大 | 501行～ | 分割検討 + 4人以上 |

## ⏱️ レビュー期限・優先度

### 緊急度レベル
| レベル | 対応時間 | 対象PR | 通知方法 |
|--------|----------|---------|----------|
| L1 (Critical) | 1時間以内 | 本番障害修正 | Slack + 電話 |
| L2 (High) | 4時間以内 | セキュリティ修正 | Slack + メール |
| L3 (Medium) | 1営業日以内 | 機能追加・バグ修正 | GitHub通知 |
| L4 (Low) | 3営業日以内 | リファクタリング | GitHub通知 |

### レビュー期限の計算
```javascript
// レビュー期限計算例
const calculateReviewDeadline = (prSize, urgencyLevel) => {
  const baseHours = {
    L1: 1, L2: 4, L3: 24, L4: 72
  };
  
  const sizeMultiplier = {
    small: 1.0, medium: 1.5, large: 2.0, xlarge: 3.0
  };
  
  return baseHours[urgencyLevel] * sizeMultiplier[prSize];
};
```

## 🔍 レビューチェックポイント

### コード品質
- [ ] **可読性**: コードが理解しやすいか
- [ ] **保守性**: 将来の変更に対応しやすいか
- [ ] **再利用性**: 適切な関数・クラス設計か
- [ ] **命名規則**: 一貫した命名になっているか
- [ ] **コメント**: 適切なコメントが記載されているか

### 設計・アーキテクチャ
- [ ] **SOLID原則**: 適切に適用されているか
- [ ] **DRY原則**: 重複コードがないか
- [ ] **関心の分離**: 適切に責務が分離されているか
- [ ] **依存関係**: 適切な依存関係になっているか
- [ ] **デザインパターン**: 適切なパターンが使用されているか

### パフォーマンス
- [ ] **アルゴリズム**: 効率的なアルゴリズムか
- [ ] **データ構造**: 適切なデータ構造か
- [ ] **メモリ使用量**: メモリリークはないか
- [ ] **データベース**: N+1問題はないか
- [ ] **キャッシュ**: 適切なキャッシュ戦略か

### セキュリティ
- [ ] **入力検証**: すべての入力値が検証されているか
- [ ] **出力エスケープ**: XSS対策が実装されているか
- [ ] **SQL インジェクション**: 対策が実装されているか
- [ ] **認証・認可**: 適切なアクセス制御か
- [ ] **機密情報**: ハードコードされていないか

### テスト
- [ ] **テストカバレッジ**: 十分なカバレッジがあるか
- [ ] **テスト品質**: 適切なテストケースか
- [ ] **テスト可読性**: テストが理解しやすいか
- [ ] **モック・スタブ**: 適切に使用されているか
- [ ] **エッジケース**: 境界値テストがあるか

## 🚀 マージ基準

### 必須条件
- [ ] 必要なレビュアーからの承認
- [ ] すべてのCI/CDチェック通過
- [ ] コンフリクト解消
- [ ] ブランチ保護ルール準拠

### 品質基準
- [ ] テストカバレッジ ≥ 80%
- [ ] 静的解析エラー 0件
- [ ] セキュリティスキャン PASS
- [ ] パフォーマンステスト PASS

### ドキュメント基準
- [ ] README更新（必要に応じて）
- [ ] API仕様書更新（API変更時）
- [ ] CHANGELOG更新
- [ ] マイグレーションガイド作成（Breaking Changes時）

## 📊 レビュー品質メトリクス

### 計測項目
```yaml
metrics:
  review_coverage:
    - reviewed_lines / total_lines
  review_time:
    - first_review_time
    - total_review_time
  review_cycles:
    - number_of_review_rounds
  defect_detection:
    - bugs_found_in_review
    - security_issues_found
  reviewer_workload:
    - reviews_per_person
    - review_time_per_person
```

### 改善指標
- **レビュー時間短縮**: 効率的なレビュープロセス
- **品質向上**: バグ発見率の向上
- **知識共有**: レビューコメントの質向上
- **チーム成長**: 新人のレビュースキル向上

## 🎓 レビューのベストプラクティス

### レビュアー向け
```markdown
### 良いレビューコメント例

❌ 悪い例:
"これは間違っています"

✅ 良い例:
"この処理では配列が空の場合にエラーになる可能性があります。
`array.length > 0` のチェックを追加することを提案します。
参考: [配列チェックのベストプラクティス](link)"

❌ 悪い例:
"変数名が悪い"

✅ 良い例:
"変数名 `data` は汎用的すぎるため、`userProfiles` のような
具体的な名前にすることで可読性が向上します。"
```

### 作成者向け
```markdown
### レビューを受ける際の心構え

✅ Do（すべきこと）:
- レビューコメントに建設的に対応
- 質問があれば遠慮なく確認
- 改善提案を積極的に取り入れ
- レビューの理由を理解しようと努める

❌ Don't（すべきでないこと）:
- レビューコメントを個人攻撃と受け取る
- 説明なしにレビューを無視
- 「時間がない」を理由にレビューを急かす
- 同じ間違いを繰り返す
```

## 🔧 ツール・自動化

### 推奨ツール
```yaml
static_analysis:
  - ESLint (JavaScript/TypeScript)
  - SonarQube (多言語対応)
  - CodeClimate (コード品質)

security_scanning:
  - Snyk (依存関係脆弱性)
  - GitLeaks (シークレット検出)
  - Semgrep (SAST)

performance_testing:
  - Lighthouse (フロントエンド)
  - JMeter (API負荷テスト)
  - k6 (パフォーマンステスト)
```

### CI/CD統合
```yaml
# GitHub Actions例
pr_checks:
  - lint
  - test
  - security_scan
  - performance_test
  - visual_regression_test
```

## 📚 教育・トレーニング

### 新人向けプログラム
1. **Week 1**: PRレビューガイドライン理解
2. **Week 2**: 実際のPRレビュー参加（観察）
3. **Week 3**: 小規模PRのレビュー実践
4. **Week 4**: レビューフィードバックと改善

### 継続教育
- **月次勉強会**: ベストプラクティス共有
- **四半期レビュー**: プロセス改善検討
- **年次研修**: 最新技術・手法の学習
- **外部研修**: カンファレンス参加推奨

## 🔄 継続的改善

### レビュープロセス改善
```yaml
improvement_cycle:
  collect_feedback:
    - レビューアーアンケート
    - 作成者フィードバック
    - メトリクス分析
  
  identify_issues:
    - ボトルネック特定
    - 品質問題の傾向分析
    - プロセス効率化ポイント
  
  implement_changes:
    - ガイドライン更新
    - ツール導入・改善
    - トレーニング実施
  
  measure_results:
    - 改善効果測定
    - KPI追跡
    - チーム満足度調査
```

## 📞 サポート・問い合わせ

### 技術サポート
- **一般的な質問**: github@sas-com.com
- **セキュリティ関連**: security@sas-com.com
- **緊急時対応**: github@sas-com.com（件名に【緊急】を記載）

### エスカレーション
- **プロセス改善提案**: テックリードまたはEM
- **ツール導入要請**: インフラチーム
- **教育・研修要請**: 人事・教育担当

## 🔄 更新履歴

- **2025-09-10**: 初版作成
- **2025-09-10**: セキュリティチェックリスト追加
- **2025-09-10**: 自動化ツール連携ガイド追加

---

**注意**: このガイドラインは定期的に見直し・更新されます。最新版は常にこのファイルを参照してください。