name: PR Comprehensive Testing Pipeline

on:
  pull_request:
    branches: [ main, develop, staging ]
    types: [ opened, synchronize, reopened ]
  pull_request_review:
    types: [ submitted ]

permissions:
  contents: read
  pull-requests: write
  checks: write
  security-events: write

env:
  NODE_VERSION: '20'
  PYTHON_VERSION: '3.11'
  JAVA_VERSION: '11'

jobs:
  # ========================================
  # Stage 1: Âü∫Êú¨ÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØÔºàÈ´òÈÄüÂÆüË°åÔºâ
  # ========================================
  basic-quality:
    name: Âü∫Êú¨ÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØ
    runs-on: ubuntu-latest
    timeout-minutes: 10
    outputs:
      pr-type: ${{ steps.pr-analyzer.outputs.pr-type }}
      test-strategy: ${{ steps.pr-analyzer.outputs.test-strategy }}
      changed-files: ${{ steps.changed-files.outputs.files }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: PRÂÜÖÂÆπÂàÜÊûê
        id: pr-analyzer
        run: |
          # PR„Çø„Ç§„Éà„É´„Å®„Éñ„É©„É≥„ÉÅÂêç„Åã„ÇâPRÁ®ÆÂà•„ÇíÂà§ÂÆö
          PR_TITLE="${{ github.event.pull_request.title }}"
          BRANCH_NAME="${{ github.head_ref }}"
          
          if [[ "$PR_TITLE" =~ ^hotfix ]]; then
            echo "pr-type=hotfix" >> $GITHUB_OUTPUT
            echo "test-strategy=minimal" >> $GITHUB_OUTPUT
          elif [[ "$PR_TITLE" =~ ^fix ]]; then
            echo "pr-type=bugfix" >> $GITHUB_OUTPUT
            echo "test-strategy=focused" >> $GITHUB_OUTPUT
          elif [[ "$PR_TITLE" =~ ^feat ]]; then
            echo "pr-type=feature" >> $GITHUB_OUTPUT
            echo "test-strategy=comprehensive" >> $GITHUB_OUTPUT
          elif [[ "$PR_TITLE" =~ ^refactor ]]; then
            echo "pr-type=refactor" >> $GITHUB_OUTPUT
            echo "test-strategy=regression" >> $GITHUB_OUTPUT
          else
            echo "pr-type=general" >> $GITHUB_OUTPUT
            echo "test-strategy=standard" >> $GITHUB_OUTPUT
          fi

      - name: Â§âÊõ¥„Éï„Ç°„Ç§„É´Ê§úÂá∫
        id: changed-files
        run: |
          git diff --name-only origin/main...HEAD > changed-files.txt
          echo "files=$(cat changed-files.txt | tr '\n' ' ')" >> $GITHUB_OUTPUT
          
          # „Éï„Ç°„Ç§„É´Á®ÆÂà•Âà•„ÅÆÂ§âÊõ¥Ê§úÂá∫
          if grep -q "\.js$\|\.ts$\|\.jsx$\|\.tsx$" changed-files.txt; then
            echo "has-frontend=true" >> $GITHUB_OUTPUT
          fi
          if grep -q "\.py$" changed-files.txt; then
            echo "has-python=true" >> $GITHUB_OUTPUT
          fi
          if grep -q "\.java$" changed-files.txt; then
            echo "has-java=true" >> $GITHUB_OUTPUT
          fi
          if grep -q "Dockerfile\|docker-compose" changed-files.txt; then
            echo "has-docker=true" >> $GITHUB_OUTPUT
          fi
          if grep -q "\.md$" changed-files.txt; then
            echo "has-docs=true" >> $GITHUB_OUTPUT
          fi

      - name: Setup Node.js
        if: steps.changed-files.outputs.has-frontend == 'true'
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        if: steps.changed-files.outputs.has-frontend == 'true'
        run: npm ci

      - name: Lint - JavaScript/TypeScript
        if: steps.changed-files.outputs.has-frontend == 'true'
        run: |
          npm run lint || echo "::warning::Linting issues found"
          npm run lint:fix || true

      - name: Format check - Prettier
        if: steps.changed-files.outputs.has-frontend == 'true'
        run: |
          npm run format:check || echo "::warning::Format issues found"

      - name: Type check - TypeScript
        if: steps.changed-files.outputs.has-frontend == 'true'
        run: |
          npm run type-check || echo "::error::Type errors found"

      - name: Lint - Python
        if: steps.changed-files.outputs.has-python == 'true'
        run: |
          pip install flake8 black isort mypy
          flake8 --max-line-length=88 --extend-ignore=E203,W503 .
          black --check .
          isort --check-only .
          mypy --ignore-missing-imports .

      - name: Lint - Markdown
        if: steps.changed-files.outputs.has-docs == 'true'
        run: |
          npm install -g markdownlint-cli
          markdownlint **/*.md --config .markdownlint.json || echo "::warning::Markdown issues found"

      - name: Âü∫Êú¨ÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØÁµêÊûú
        run: |
          echo "‚úÖ Âü∫Êú¨ÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØÂÆå‰∫Ü"
          echo "üìä PRÁ®ÆÂà•: ${{ steps.pr-analyzer.outputs.pr-type }}"
          echo "üéØ „ÉÜ„Çπ„ÉàÊà¶Áï•: ${{ steps.pr-analyzer.outputs.test-strategy }}"

  # ========================================
  # Stage 1.5: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Çπ„Ç≠„É£„É≥Ôºà‰∏¶Ë°åÂÆüË°åÔºâ
  # ========================================
  security-scan:
    name: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Çπ„Ç≠„É£„É≥
    runs-on: ubuntu-latest
    timeout-minutes: 15
    needs: basic-quality
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: „Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÊ§úÂá∫ - GitLeaks
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: ‰æùÂ≠òÈñ¢‰øÇËÑÜÂº±ÊÄß„Çπ„Ç≠„É£„É≥ - npm
        if: contains(needs.basic-quality.outputs.changed-files, '.js') || contains(needs.basic-quality.outputs.changed-files, '.ts')
        run: |
          npm audit --audit-level=high
          npm audit fix --dry-run

      - name: SAST „Çπ„Ç≠„É£„É≥ - Semgrep
        uses: semgrep/semgrep-action@v1
        with:
          config: >-
            p/security-audit
            p/secrets
            p/owasp-top-ten
            p/javascript
            p/typescript
            p/python
        env:
          SEMGREP_APP_TOKEN: ${{ secrets.SEMGREP_APP_TOKEN }}

      - name: Dockerfile „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÅ„Çß„ÉÉ„ÇØ
        if: contains(needs.basic-quality.outputs.changed-files, 'Dockerfile')
        run: |
          docker run --rm -i hadolint/hadolint < Dockerfile || echo "::warning::Dockerfile issues found"

      - name: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Çπ„Ç≠„É£„É≥ÁµêÊûú„Çµ„Éû„É™„Éº
        run: |
          echo "üîí „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Çπ„Ç≠„É£„É≥ÂÆå‰∫Ü"
          echo "- „Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÊ§úÂá∫: ‚úÖ"
          echo "- ‰æùÂ≠òÈñ¢‰øÇËÑÜÂº±ÊÄß: ‚úÖ"
          echo "- SAST „Çπ„Ç≠„É£„É≥: ‚úÖ"

  # ========================================
  # Stage 2: Âçò‰Ωì„ÉÜ„Çπ„ÉàÔºà‰∏¶Ë°åÂÆüË°åÔºâ
  # ========================================
  unit-tests:
    name: Âçò‰Ωì„ÉÜ„Çπ„Éà
    runs-on: ubuntu-latest
    timeout-minutes: 20
    needs: basic-quality
    strategy:
      matrix:
        test-type: [frontend, backend, docs]
        exclude:
          - test-type: frontend
            # „Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„Éï„Ç°„Ç§„É´„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÈô§Â§ñ
          - test-type: backend
            # „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Éï„Ç°„Ç§„É´„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÈô§Â§ñ
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js (Frontend)
        if: matrix.test-type == 'frontend'
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Setup Python (Backend)
        if: matrix.test-type == 'backend'
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install Frontend Dependencies
        if: matrix.test-type == 'frontend'
        run: npm ci

      - name: Install Backend Dependencies
        if: matrix.test-type == 'backend'
        run: |
          pip install -r requirements.txt
          pip install pytest pytest-cov pytest-mock

      - name: Run Frontend Unit Tests
        if: matrix.test-type == 'frontend'
        run: |
          npm test -- --coverage --watchAll=false
          echo "FRONTEND_COVERAGE=$(npm test -- --coverage --watchAll=false --silent | grep 'All files' | awk '{print $10}')" >> $GITHUB_ENV

      - name: Run Backend Unit Tests
        if: matrix.test-type == 'backend'
        run: |
          pytest --cov=. --cov-report=xml --cov-report=term
          echo "BACKEND_COVERAGE=$(pytest --cov=. --cov-report=term | grep TOTAL | awk '{print $4}')" >> $GITHUB_ENV

      - name: Documentation Tests
        if: matrix.test-type == 'docs'
        run: |
          # „É™„É≥„ÇØÂàá„Çå„ÉÅ„Çß„ÉÉ„ÇØ
          npm install -g markdown-link-check
          find . -name "*.md" -exec markdown-link-check {} \; || echo "::warning::Broken links found"
          
          # „Çπ„Éö„É´„ÉÅ„Çß„ÉÉ„ÇØ
          npm install -g cspell
          cspell "**/*.md" --config .cspell.json || echo "::warning::Spelling issues found"

      - name: Upload Coverage Reports
        if: matrix.test-type != 'docs'
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage.xml
          flags: ${{ matrix.test-type }}
          name: ${{ matrix.test-type }}-coverage

  # ========================================
  # Stage 3: Áµ±Âêà„ÉÜ„Çπ„ÉàÔºàÊù°‰ª∂‰ªò„ÅçÂÆüË°åÔºâ
  # ========================================
  integration-tests:
    name: Áµ±Âêà„ÉÜ„Çπ„Éà
    runs-on: ubuntu-latest
    timeout-minutes: 30
    needs: [basic-quality, unit-tests]
    if: needs.basic-quality.outputs.test-strategy != 'minimal'
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: testpass
          POSTGRES_DB: testdb
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Database Setup
        run: |
          npm run db:migrate
          npm run db:seed:test

      - name: API Integration Tests
        run: |
          npm run test:integration
        env:
          DATABASE_URL: postgresql://postgres:testpass@localhost:5432/testdb
          REDIS_URL: redis://localhost:6379

      - name: Database Integration Tests
        run: |
          npm run test:db

      - name: External Service Integration Tests
        run: |
          npm run test:external

  # ========================================
  # Stage 4: E2E„ÉÜ„Çπ„ÉàÔºàÈÅ∏ÊäûÁöÑÂÆüË°åÔºâ
  # ========================================
  e2e-tests:
    name: E2E„ÉÜ„Çπ„Éà
    runs-on: ubuntu-latest
    timeout-minutes: 45
    needs: [basic-quality, integration-tests]
    if: needs.basic-quality.outputs.test-strategy == 'comprehensive' || needs.basic-quality.outputs.pr-type == 'feature'
    
    strategy:
      matrix:
        browser: [chromium, firefox]
        
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright
        run: npx playwright install --with-deps ${{ matrix.browser }}

      - name: Build application
        run: npm run build

      - name: Start application
        run: |
          npm start &
          sleep 30
        env:
          NODE_ENV: test

      - name: Run E2E tests
        run: |
          npx playwright test --browser=${{ matrix.browser }}
        env:
          PLAYWRIGHT_BASE_URL: http://localhost:3000

      - name: Upload E2E artifacts
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: e2e-artifacts-${{ matrix.browser }}
          path: |
            test-results/
            playwright-report/

  # ========================================
  # Stage 5: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„ÉàÔºàÈÅ∏ÊäûÁöÑÂÆüË°åÔºâ
  # ========================================
  performance-tests:
    name: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà
    runs-on: ubuntu-latest
    timeout-minutes: 20
    needs: [basic-quality, unit-tests]
    if: needs.basic-quality.outputs.pr-type == 'feature' || contains(needs.basic-quality.outputs.changed-files, 'performance')
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build application
        run: npm run build

      - name: Lighthouse CI
        run: |
          npm install -g @lhci/cli
          lhci autorun
        env:
          LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}

      - name: Bundle Size Check
        run: |
          npm run analyze:bundle
          npm run check:bundle-size

      - name: Load Testing (K6)
        run: |
          docker run --rm -v $(pwd)/tests/load:/tests grafana/k6 run /tests/load-test.js

  # ========================================
  # ÁµêÊûúÈõÜÁ¥Ñ„Å®„É¨„Éù„Éº„Éà
  # ========================================
  test-summary:
    name: „ÉÜ„Çπ„ÉàÁµêÊûú„Çµ„Éû„É™„Éº
    runs-on: ubuntu-latest
    needs: [basic-quality, security-scan, unit-tests, integration-tests, e2e-tests, performance-tests]
    if: always()
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download artifacts
        uses: actions/download-artifact@v3
        with:
          path: ./artifacts

      - name: Generate Test Report
        run: |
          cat > test-summary.md << 'EOF'
          # üß™ PR „ÉÜ„Çπ„ÉàÁµêÊûú„Çµ„Éû„É™„Éº

          ## üìä ÂÆüË°åÊ¶ÇË¶Å
          - **PRÁ®ÆÂà•**: ${{ needs.basic-quality.outputs.pr-type }}
          - **„ÉÜ„Çπ„ÉàÊà¶Áï•**: ${{ needs.basic-quality.outputs.test-strategy }}
          - **ÂÆüË°åÊôÇÂàª**: $(date '+%Y-%m-%d %H:%M:%S UTC')

          ## ‚úÖ „ÉÜ„Çπ„ÉàÁµêÊûú

          ### Stage 1: Âü∫Êú¨ÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØ
          - „Ç≥„Éº„Éâ„É™„É≥„ÉÜ„Ç£„É≥„Ç∞: ${{ needs.basic-quality.result == 'success' && '‚úÖ PASS' || '‚ùå FAIL' }}
          - „Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÉÅ„Çß„ÉÉ„ÇØ: ${{ needs.basic-quality.result == 'success' && '‚úÖ PASS' || '‚ùå FAIL' }}
          - Âûã„ÉÅ„Çß„ÉÉ„ÇØ: ${{ needs.basic-quality.result == 'success' && '‚úÖ PASS' || '‚ùå FAIL' }}

          ### Stage 1.5: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Çπ„Ç≠„É£„É≥
          - „Ç∑„Éº„ÇØ„É¨„ÉÉ„ÉàÊ§úÂá∫: ${{ needs.security-scan.result == 'success' && '‚úÖ PASS' || '‚ùå FAIL' }}
          - ‰æùÂ≠òÈñ¢‰øÇËÑÜÂº±ÊÄß: ${{ needs.security-scan.result == 'success' && '‚úÖ PASS' || '‚ùå FAIL' }}
          - SAST „Çπ„Ç≠„É£„É≥: ${{ needs.security-scan.result == 'success' && '‚úÖ PASS' || '‚ùå FAIL' }}

          ### Stage 2: Âçò‰Ωì„ÉÜ„Çπ„Éà
          - „Éï„É≠„É≥„Éà„Ç®„É≥„Éâ: ${{ needs.unit-tests.result == 'success' && '‚úÖ PASS' || '‚ùå FAIL' }}
          - „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ: ${{ needs.unit-tests.result == 'success' && '‚úÖ PASS' || '‚ùå FAIL' }}
          - „Éâ„Ç≠„É•„É°„É≥„Éà: ${{ needs.unit-tests.result == 'success' && '‚úÖ PASS' || '‚ùå FAIL' }}

          ### Stage 3: Áµ±Âêà„ÉÜ„Çπ„Éà
          - APIÁµ±Âêà„ÉÜ„Çπ„Éà: ${{ needs.integration-tests.result == 'success' && '‚úÖ PASS' || needs.integration-tests.result == 'skipped' && '‚è≠Ô∏è SKIP' || '‚ùå FAIL' }}
          - DBÁµ±Âêà„ÉÜ„Çπ„Éà: ${{ needs.integration-tests.result == 'success' && '‚úÖ PASS' || needs.integration-tests.result == 'skipped' && '‚è≠Ô∏è SKIP' || '‚ùå FAIL' }}

          ### Stage 4: E2E„ÉÜ„Çπ„Éà
          - Chromium: ${{ needs.e2e-tests.result == 'success' && '‚úÖ PASS' || needs.e2e-tests.result == 'skipped' && '‚è≠Ô∏è SKIP' || '‚ùå FAIL' }}
          - Firefox: ${{ needs.e2e-tests.result == 'success' && '‚úÖ PASS' || needs.e2e-tests.result == 'skipped' && '‚è≠Ô∏è SKIP' || '‚ùå FAIL' }}

          ### Stage 5: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà
          - Lighthouse: ${{ needs.performance-tests.result == 'success' && '‚úÖ PASS' || needs.performance-tests.result == 'skipped' && '‚è≠Ô∏è SKIP' || '‚ùå FAIL' }}
          - „Éê„É≥„Éâ„É´„Çµ„Ç§„Ç∫: ${{ needs.performance-tests.result == 'success' && '‚úÖ PASS' || needs.performance-tests.result == 'skipped' && '‚è≠Ô∏è SKIP' || '‚ùå FAIL' }}
          - Ë≤†Ëç∑„ÉÜ„Çπ„Éà: ${{ needs.performance-tests.result == 'success' && '‚úÖ PASS' || needs.performance-tests.result == 'skipped' && '‚è≠Ô∏è SKIP' || '‚ùå FAIL' }}

          ## üìà ÂìÅË≥™„É°„Éà„É™„ÇØ„Çπ
          - „ÉÜ„Çπ„Éà„Ç´„Éê„É¨„ÉÉ„Ç∏: [Codecov „É¨„Éù„Éº„Éà„ÇíÁ¢∫Ë™ç](https://codecov.io/gh/${{ github.repository }}/pull/${{ github.event.number }})
          - „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Çπ„Ç≥„Ç¢: [Semgrep „É¨„Éù„Éº„Éà„ÇíÁ¢∫Ë™ç](https://semgrep.dev/projects/${{ github.repository }}/findings)

          ## üöÄ Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó
          ${{ needs.basic-quality.result != 'success' && '‚ùó Âü∫Êú¨ÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØ„ÅÆÂïèÈ°å„ÇíËß£Ê±∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ' || '' }}
          ${{ needs.security-scan.result != 'success' && '‚ùó „Çª„Ç≠„É•„É™„ÉÜ„Ç£ÂïèÈ°å„ÇíËß£Ê±∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ' || '' }}
          ${{ needs.unit-tests.result != 'success' && '‚ùó Âçò‰Ωì„ÉÜ„Çπ„Éà„ÅÆÂïèÈ°å„ÇíËß£Ê±∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ' || '' }}
          ${{ (needs.basic-quality.result == 'success' && needs.security-scan.result == 'success' && needs.unit-tests.result == 'success') && '‚úÖ „Åô„Åπ„Å¶„ÅÆ„ÉÜ„Çπ„Éà„ÅåÊàêÂäü„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„É¨„Éì„É•„ÉºÊ∫ñÂÇôÂÆå‰∫Ü„Åß„ÅôÔºÅ' || '' }}

          ---
          ü§ñ „Åì„ÅÆ„É¨„Éù„Éº„Éà„ÅØËá™ÂãïÁîüÊàê„Åï„Çå„Åæ„Åó„Åü„ÄÇË©≥Á¥∞„ÅØÂÄãÂà•„ÅÆ„ÉÜ„Çπ„ÉàÁµêÊûú„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          EOF

      - name: PR Comment with Test Summary
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const testSummary = fs.readFileSync('test-summary.md', 'utf8');
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: testSummary
            });

      - name: Set PR Status
        if: failure()
        run: |
          echo "‚ùå ‰∏ÄÈÉ®„ÅÆ„ÉÜ„Çπ„Éà„ÅåÂ§±Êïó„Åó„Åæ„Åó„Åü„ÄÇË©≥Á¥∞„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"
          exit 1