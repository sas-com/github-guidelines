name: Hotfixç·Šæ€¥å¯¾å¿œãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

on:
  push:
    branches: [ 'hotfix/**' ]
  workflow_dispatch:
    inputs:
      severity:
        description: 'ç·Šæ€¥åº¦ãƒ¬ãƒ™ãƒ«'
        required: true
        type: choice
        options:
          - 'L1-Critical'
          - 'L2-High'
          - 'L3-Medium'
          - 'L4-Low'
      description:
        description: 'å•é¡Œã®èª¬æ˜Ž'
        required: true
        type: string
      skip_approval:
        description: 'L1ç·Šæ€¥æ™‚ã®æ‰¿èªã‚¹ã‚­ãƒƒãƒ—'
        required: false
        default: false
        type: boolean

env:
  EMERGENCY_CONTACT: 'github@sas-com.com'

jobs:
  # =============================================================================
  # ç·Šæ€¥åº¦åˆ¤å®šãƒ»é€šçŸ¥
  # =============================================================================
  emergency-assessment:
    name: ç·Šæ€¥åº¦åˆ¤å®šãƒ»åˆæœŸé€šçŸ¥
    runs-on: ubuntu-latest
    outputs:
      severity: ${{ steps.assess.outputs.severity }}
      skip_tests: ${{ steps.assess.outputs.skip_tests }}
      require_approval: ${{ steps.assess.outputs.require_approval }}
    
    steps:
      - name: ç·Šæ€¥åº¦åˆ¤å®š
        id: assess
        run: |
          # ãƒ–ãƒ©ãƒ³ãƒåã‹ã‚‰ç·Šæ€¥åº¦ã‚’åˆ¤å®š
          if [[ "${{ github.ref_name }}" =~ hotfix/l1-.* ]] || [[ "${{ inputs.severity }}" == "L1-Critical" ]]; then
            echo "severity=L1-Critical" >> $GITHUB_OUTPUT
            echo "skip_tests=true" >> $GITHUB_OUTPUT
            echo "require_approval=false" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref_name }}" =~ hotfix/l2-.* ]] || [[ "${{ inputs.severity }}" == "L2-High" ]]; then
            echo "severity=L2-High" >> $GITHUB_OUTPUT
            echo "skip_tests=false" >> $GITHUB_OUTPUT
            echo "require_approval=true" >> $GITHUB_OUTPUT
          else
            echo "severity=L3-Medium" >> $GITHUB_OUTPUT
            echo "skip_tests=false" >> $GITHUB_OUTPUT
            echo "require_approval=true" >> $GITHUB_OUTPUT
          fi
      
      - name: ç·Šæ€¥æ™‚é€šçŸ¥é€ä¿¡
        uses: 8398a7/action-slack@v3
        with:
          status: custom
          custom_payload: |
            {
              "text": "ðŸš¨ HOTFIXç·Šæ€¥å¯¾å¿œé–‹å§‹",
              "blocks": [
                {
                  "type": "header",
                  "text": {
                    "type": "plain_text",
                    "text": "ðŸš¨ HOTFIXç·Šæ€¥å¯¾å¿œé–‹å§‹"
                  }
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "*ç·Šæ€¥åº¦:* ${{ steps.assess.outputs.severity }}"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*ãƒªãƒã‚¸ãƒˆãƒª:* ${{ github.repository }}"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*ãƒ–ãƒ©ãƒ³ãƒ:* ${{ github.ref_name }}"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*å®Ÿè¡Œè€…:* ${{ github.actor }}"
                    }
                  ]
                },
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "*å•é¡Œã®èª¬æ˜Ž:*\n${{ inputs.description || 'ãƒ–ãƒ©ãƒ³ãƒåã‹ã‚‰è‡ªå‹•åˆ¤å®š' }}"
                  }
                }
              ]
            }
          webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}

  # =============================================================================
  # æœ€å°é™ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
  # =============================================================================
  minimal-security:
    name: æœ€å°é™ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
    runs-on: ubuntu-latest
    needs: emergency-assessment
    
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
      
      - name: é‡è¦ãªç§˜å¯†æƒ…å ±ã‚¹ã‚­ãƒ£ãƒ³
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: å±é™ºãªã‚³ãƒ¼ãƒ‰æ¤œå‡º
        run: |
          echo "å±é™ºãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ä¸­..."
          
          # å±é™ºãªã‚³ãƒžãƒ³ãƒ‰ã®æ¤œå‡º
          if grep -r "rm -rf" . --exclude-dir=.git; then
            echo "âŒ å±é™ºãªã‚³ãƒžãƒ³ãƒ‰ 'rm -rf' ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
            exit 1
          fi
          
          # å¼·åˆ¶ãƒ—ãƒƒã‚·ãƒ¥ã®ãƒã‚§ãƒƒã‚¯
          if grep -r "git push.*--force" . --exclude-dir=.git; then
            echo "âŒ å¼·åˆ¶ãƒ—ãƒƒã‚·ãƒ¥ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼ˆç¦æ­¢ï¼‰"
            exit 1
          fi
          
          # æ©Ÿå¯†æƒ…å ±ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒã‚§ãƒƒã‚¯
          if grep -rE "(password|secret|key).*=.*['\"][^'\"]{8,}" . --exclude-dir=.git; then
            echo "âŒ ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ©Ÿå¯†æƒ…å ±ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™"
            exit 1
          fi
          
          echo "âœ… æœ€å°é™ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯å®Œäº†"

  # =============================================================================
  # ç·Šæ€¥ãƒ†ã‚¹ãƒˆï¼ˆL2ä»¥ä¸‹ã®ã¿ï¼‰
  # =============================================================================
  emergency-test:
    name: ç·Šæ€¥æ™‚ãƒ†ã‚¹ãƒˆ
    runs-on: ubuntu-latest
    needs: [emergency-assessment, minimal-security]
    if: needs.emergency-assessment.outputs.skip_tests != 'true'
    
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
      
      - name: é‡è¦æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        run: |
          echo "é‡è¦æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­..."
          
          # Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
          find . -name "*.md" -not -path "./.git/*" | while read file; do
            echo "ãƒã‚§ãƒƒã‚¯ä¸­: $file"
            # markdownlint "$file" || echo "è­¦å‘Š: $file ã«è»½å¾®ãªå•é¡ŒãŒã‚ã‚Šã¾ã™"
          done
          
          # YAMLãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
          find . -name "*.yml" -o -name "*.yaml" -not -path "./.git/*" | while read file; do
            echo "ãƒã‚§ãƒƒã‚¯ä¸­: $file"
            python -c "import yaml; yaml.safe_load(open('$file'))" || exit 1
          done
          
          echo "âœ… é‡è¦æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Œäº†"

  # =============================================================================
  # ç·Šæ€¥ãƒ“ãƒ«ãƒ‰
  # =============================================================================
  emergency-build:
    name: ç·Šæ€¥ãƒ“ãƒ«ãƒ‰
    runs-on: ubuntu-latest
    needs: [emergency-assessment, minimal-security]
    if: always() && !failure()
    
    outputs:
      version: ${{ steps.version.outputs.version }}
    
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
      
      - name: Hotfixãƒãƒ¼ã‚¸ãƒ§ãƒ³ç”Ÿæˆ
        id: version
        run: |
          SEVERITY="${{ needs.emergency-assessment.outputs.severity }}"
          TIMESTAMP=$(date +'%Y%m%d-%H%M%S')
          SHORT_SHA=$(echo ${{ github.sha }} | cut -c1-8)
          VERSION="hotfix-${SEVERITY}-${TIMESTAMP}-${SHORT_SHA}"
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "ç·Šæ€¥ä¿®æ­£ãƒãƒ¼ã‚¸ãƒ§ãƒ³: $VERSION"
      
      - name: ç·Šæ€¥ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
        run: |
          mkdir -p emergency-build/
          
          # é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼
          cp *.md emergency-build/ 2>/dev/null || true
          cp -r .github emergency-build/ 2>/dev/null || true
          
          # ç·Šæ€¥ä¿®æ­£ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
          cat > emergency-build/hotfix-metadata.json << EOF
          {
            "version": "${{ steps.version.outputs.version }}",
            "severity": "${{ needs.emergency-assessment.outputs.severity }}",
            "timestamp": "$(date -Iseconds)",
            "commit": "${{ github.sha }}",
            "branch": "${{ github.ref_name }}",
            "author": "${{ github.actor }}",
            "description": "${{ inputs.description || 'Emergency hotfix' }}"
          }
          EOF
          
          echo "âœ… ç·Šæ€¥ãƒ“ãƒ«ãƒ‰å®Œäº†"
      
      - name: æˆæžœç‰©ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-artifact@v3
        with:
          name: emergency-build-${{ steps.version.outputs.version }}
          path: emergency-build/
          retention-days: 90

  # =============================================================================
  # ç·Šæ€¥æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹
  # =============================================================================
  emergency-approval:
    name: ç·Šæ€¥æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹
    runs-on: ubuntu-latest
    needs: [emergency-assessment, emergency-build]
    if: needs.emergency-assessment.outputs.require_approval == 'true' && !inputs.skip_approval
    
    steps:
      - name: ç·Šæ€¥æ‰¿èªè¦æ±‚
        uses: trstringer/manual-approval@v1
        with:
          secret: ${{ github.TOKEN }}
          approvers: sas-github-admin,sas-tech-lead
          minimum-approvals: 1
          issue-title: "ðŸš¨ HOTFIXç·Šæ€¥æ‰¿èªè¦æ±‚ - ${{ needs.emergency-assessment.outputs.severity }}"
          issue-body: |
            ## ðŸš¨ HOTFIXç·Šæ€¥æ‰¿èªè¦æ±‚
            
            ### ç·Šæ€¥ä¿®æ­£è©³ç´°
            - **ç·Šæ€¥åº¦**: ${{ needs.emergency-assessment.outputs.severity }}
            - **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: ${{ needs.emergency-build.outputs.version }}
            - **ãƒ–ãƒ©ãƒ³ãƒ**: ${{ github.ref_name }}
            - **å®Ÿè¡Œè€…**: ${{ github.actor }}
            - **ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—**: $(date -Iseconds)
            
            ### å•é¡Œã®èª¬æ˜Ž
            ${{ inputs.description || 'ãƒ–ãƒ©ãƒ³ãƒåã‹ã‚‰è‡ªå‹•åˆ¤å®šã•ã‚ŒãŸç·Šæ€¥ä¿®æ­£' }}
            
            ### å®Ÿæ–½ã•ã‚ŒãŸæ¤œè¨¼
            - âœ… æœ€å°é™ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯å®Œäº†
            - âœ… ç·Šæ€¥ãƒ“ãƒ«ãƒ‰å®Œäº†
            ${{ needs.emergency-assessment.outputs.skip_tests == 'true' && '- âš ï¸  ãƒ†ã‚¹ãƒˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆL1ç·Šæ€¥å¯¾å¿œï¼‰' || '- âœ… ç·Šæ€¥ãƒ†ã‚¹ãƒˆå®Œäº†' }}
            
            ### ãƒªã‚¹ã‚¯ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ
            - **å½±éŸ¿ç¯„å›²**: [è¨˜è¼‰ã—ã¦ãã ã•ã„]
            - **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»**: [è¨˜è¼‰ã—ã¦ãã ã•ã„]
            - **ç›£è¦–è¨ˆç”»**: [è¨˜è¼‰ã—ã¦ãã ã•ã„]
            
            ---
            **æ³¨æ„**: ã“ã‚Œã¯ç·Šæ€¥ä¿®æ­£ã§ã™ã€‚æ‰¿èªå¾Œã€å³åº§ã«ãƒ‡ãƒ—ãƒ­ã‚¤ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚

  # =============================================================================
  # ç·Šæ€¥ãƒ‡ãƒ—ãƒ­ã‚¤
  # =============================================================================
  emergency-deploy:
    name: ç·Šæ€¥ãƒ‡ãƒ—ãƒ­ã‚¤
    runs-on: ubuntu-latest
    needs: [emergency-assessment, emergency-build, emergency-approval]
    if: always() && !failure() && (needs.emergency-assessment.outputs.require_approval == 'false' || success())
    
    environment:
      name: emergency-production
      url: https://github-guidelines.sas-com.co.jp
    
    steps:
      - name: æˆæžœç‰©ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        uses: actions/download-artifact@v3
        with:
          name: emergency-build-${{ needs.emergency-build.outputs.version }}
          path: ./emergency-build
      
      - name: ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
        run: |
          echo "ç¾åœ¨ã®æœ¬ç•ªç’°å¢ƒã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."
          BACKUP_NAME="pre-hotfix-backup-$(date +'%Y%m%d-%H%M%S')"
          echo "backup_name=$BACKUP_NAME" >> $GITHUB_ENV
          
          # å®Ÿéš›ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚³ãƒžãƒ³ãƒ‰
          # aws s3 sync s3://sas-github-guidelines-prod/ s3://sas-github-guidelines-backups/$BACKUP_NAME/
          echo "âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: $BACKUP_NAME"
      
      - name: ç·Šæ€¥ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
        run: |
          echo "ðŸš¨ ç·Šæ€¥ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œä¸­..."
          echo "ãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${{ needs.emergency-build.outputs.version }}"
          echo "ç·Šæ€¥åº¦: ${{ needs.emergency-assessment.outputs.severity }}"
          
          # æ®µéšŽçš„ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆã‚«ãƒŠãƒªã‚¢æ–¹å¼ï¼‰
          echo "1. ã‚«ãƒŠãƒªã‚¢ãƒ‡ãƒ—ãƒ­ã‚¤ (10%)"
          # kubectl set image deployment/app app=emergency:${{ needs.emergency-build.outputs.version }}
          # kubectl scale deployment/app-canary --replicas=1
          
          sleep 30
          
          echo "2. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯"
          # curl -f https://github-guidelines.sas-com.co.jp/health
          
          echo "3. å…¨ä½“ãƒ‡ãƒ—ãƒ­ã‚¤ (100%)"
          # kubectl set image deployment/app app=emergency:${{ needs.emergency-build.outputs.version }}
          # kubectl rollout status deployment/app
          
          echo "âœ… ç·Šæ€¥ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†"
      
      - name: ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œç›£è¦–è¨­å®š
        run: |
          echo "ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œç›£è¦–ã‚’è¨­å®šä¸­..."
          
          # ã‚¢ãƒ©ãƒ¼ãƒˆã®ä¸€æ™‚çš„ãªå¼·åŒ–
          # aws cloudwatch put-metric-alarm --alarm-name "hotfix-monitoring" ...
          
          echo "âœ… ç›£è¦–è¨­å®šå®Œäº†"

  # =============================================================================
  # äº‹å¾Œå‡¦ç†ãƒ»é€šçŸ¥
  # =============================================================================
  post-deployment:
    name: äº‹å¾Œå‡¦ç†ãƒ»é€šçŸ¥
    runs-on: ubuntu-latest
    needs: [emergency-assessment, emergency-build, emergency-deploy]
    if: always()
    
    steps:
      - name: ç·Šæ€¥ä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ
        run: |
          cat > hotfix-report.md << EOF
          # ðŸš¨ HOTFIXç·Šæ€¥ä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆ
          
          ## åŸºæœ¬æƒ…å ±
          - **å®Ÿè¡Œæ—¥æ™‚**: $(date -Iseconds)
          - **ç·Šæ€¥åº¦**: ${{ needs.emergency-assessment.outputs.severity }}
          - **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: ${{ needs.emergency-build.outputs.version }}
          - **å®Ÿè¡Œè€…**: ${{ github.actor }}
          - **ãƒ–ãƒ©ãƒ³ãƒ**: ${{ github.ref_name }}
          
          ## å‡¦ç†çµæžœ
          - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯: ${{ needs.minimal-security.result }}
          - ãƒ“ãƒ«ãƒ‰: ${{ needs.emergency-build.result }}
          - ãƒ‡ãƒ—ãƒ­ã‚¤: ${{ needs.emergency-deploy.result }}
          
          ## å•é¡Œã®èª¬æ˜Ž
          ${{ inputs.description || 'ãƒ–ãƒ©ãƒ³ãƒåã‹ã‚‰è‡ªå‹•åˆ¤å®š' }}
          
          ## å®Ÿæ–½ã•ã‚ŒãŸå¯¾å¿œ
          1. æœ€å°é™ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
          2. ç·Šæ€¥ãƒ“ãƒ«ãƒ‰ã®ä½œæˆ
          3. ${{ needs.emergency-assessment.outputs.require_approval == 'true' && 'æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œ' || 'L1ç·Šæ€¥å¯¾å¿œã®ãŸã‚æ‰¿èªã‚¹ã‚­ãƒƒãƒ—' }}
          4. ç·Šæ€¥ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
          
          ## ä»Šå¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
          - [ ] æ ¹æœ¬åŽŸå› åˆ†æžã®å®Ÿæ–½
          - [ ] å†ç™ºé˜²æ­¢ç­–ã®æ¤œè¨Ž
          - [ ] ç·Šæ€¥å¯¾å¿œã®æŒ¯ã‚Šè¿”ã‚Šå®Ÿæ–½
          - [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
          
          ---
          
          **ç·Šæ€¥é€£çµ¡å…ˆ**: ${{ env.EMERGENCY_CONTACT }}
          EOF
      
      - name: æœ€çµ‚é€šçŸ¥é€ä¿¡
        uses: 8398a7/action-slack@v3
        if: always()
        with:
          status: custom
          custom_payload: |
            {
              "text": "${{ needs.emergency-deploy.result == 'success' && 'âœ… HOTFIXç·Šæ€¥ä¿®æ­£å®Œäº†' || 'âŒ HOTFIXç·Šæ€¥ä¿®æ­£å¤±æ•—' }}",
              "blocks": [
                {
                  "type": "header",
                  "text": {
                    "type": "plain_text",
                    "text": "${{ needs.emergency-deploy.result == 'success' && 'âœ… HOTFIXç·Šæ€¥ä¿®æ­£å®Œäº†' || 'âŒ HOTFIXç·Šæ€¥ä¿®æ­£å¤±æ•—' }}"
                  }
                },
                {
                  "type": "section",
                  "fields": [
                    {
                      "type": "mrkdwn",
                      "text": "*ç·Šæ€¥åº¦:* ${{ needs.emergency-assessment.outputs.severity }}"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*ãƒãƒ¼ã‚¸ãƒ§ãƒ³:* ${{ needs.emergency-build.outputs.version }}"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*å®Ÿè¡Œæ™‚é–“:* $(date)"
                    },
                    {
                      "type": "mrkdwn",
                      "text": "*çµæžœ:* ${{ needs.emergency-deploy.result }}"
                    }
                  ]
                },
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "${{ needs.emergency-deploy.result == 'success' && 'ç·Šæ€¥ä¿®æ­£ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸã€‚ç›£è¦–ã‚’ç¶™ç¶šã—ã¦ãã ã•ã„ã€‚' || 'ç·Šæ€¥ä¿®æ­£ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚å³åº§ã«å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚' }}"
                  }
                },
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "*ç·Šæ€¥é€£çµ¡å…ˆ:* ${{ env.EMERGENCY_CONTACT }}"
                  }
                }
              ]
            }
          webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
      
      - name: ãƒ¬ãƒãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        uses: actions/upload-artifact@v3
        with:
          name: hotfix-report-${{ needs.emergency-build.outputs.version }}
          path: hotfix-report.md
          retention-days: 365