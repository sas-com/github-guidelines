# Security Configuration for Deployment Pipeline
# エス・エー・エス株式会社 - GitHub運用ガイドライン

# Global Security Settings
global:
  # Security scanning configuration
  security_scanning:
    enabled: true
    fail_on_critical: true
    fail_on_high: false  # Warning only for high severity
    
    # Scan types
    sast_enabled: true
    dast_enabled: true
    dependency_scan: true
    container_scan: true
    secrets_scan: true
    license_scan: true
    
    # Tool configuration
    tools:
      sast:
        - codeql
        - semgrep
        - sonarqube
      dependency:
        - snyk
        - dependabot
        - npm_audit
      container:
        - trivy
        - clair
        - snyk_container
      secrets:
        - trufflehog
        - gitleaks
        - detect_secrets

  # Compliance requirements
  compliance:
    frameworks:
      - GDPR
      - PCI_DSS
      - SOX
      - ISO27001
    
    # Audit requirements
    audit_logging: true
    audit_retention_days: 2555  # 7 years
    
    # Data protection
    data_encryption: mandatory
    pii_detection: true
    data_masking: true

# Environment-specific Security Configuration
environments:
  development:
    security_level: basic
    
    # Vulnerability thresholds (relaxed)
    vulnerability_thresholds:
      critical: block
      high: warn
      medium: allow
      low: allow
    
    # Access control
    access_control:
      authentication: basic
      authorization: rbac_basic
      mfa_required: false
      session_timeout: 8h
    
    # Network security
    network_security:
      firewall_enabled: false
      waf_enabled: false
      ddos_protection: false
      rate_limiting: basic
    
    # Data protection
    data_protection:
      encryption_at_rest: false
      encryption_in_transit: true
      key_rotation: false
      backup_encryption: false
    
    # Monitoring
    security_monitoring:
      intrusion_detection: false
      anomaly_detection: false
      threat_intelligence: false
      incident_response: manual

  staging:
    security_level: intermediate
    
    # Vulnerability thresholds (moderate)
    vulnerability_thresholds:
      critical: block
      high: block
      medium: warn
      low: allow
    
    # Access control
    access_control:
      authentication: enhanced
      authorization: rbac_enhanced
      mfa_required: true
      session_timeout: 4h
    
    # Network security
    network_security:
      firewall_enabled: true
      waf_enabled: true
      ddos_protection: basic
      rate_limiting: enhanced
      
      # IP whitelisting
      ip_whitelist:
        - "10.0.0.0/8"      # Internal network
        - "192.168.0.0/16"  # VPN network
        - "203.0.113.0/24"  # Office network
    
    # Data protection
    data_protection:
      encryption_at_rest: true
      encryption_in_transit: true
      key_rotation: true
      key_rotation_frequency: quarterly
      backup_encryption: true
    
    # Monitoring
    security_monitoring:
      intrusion_detection: true
      anomaly_detection: basic
      threat_intelligence: basic
      incident_response: automated_basic

  production:
    security_level: maximum
    
    # Vulnerability thresholds (strict)
    vulnerability_thresholds:
      critical: block
      high: block
      medium: block
      low: warn
    
    # Access control
    access_control:
      authentication: enterprise
      authorization: rbac_enterprise
      mfa_required: true
      privileged_access_management: true
      session_timeout: 1h
      concurrent_session_limit: 1
    
    # Network security
    network_security:
      firewall_enabled: true
      waf_enabled: true
      ddos_protection: enterprise
      rate_limiting: strict
      geo_blocking: true
      
      # Strict IP whitelisting (production)
      ip_whitelist:
        - "203.0.113.0/24"    # Office network only
        - "198.51.100.0/24"   # VPN network (secure)
    
    # Data protection (maximum security)
    data_protection:
      encryption_at_rest: true
      encryption_in_transit: true
      encryption_algorithm: "AES-256-GCM"
      key_rotation: true
      key_rotation_frequency: monthly
      backup_encryption: true
      pii_encryption: mandatory
      database_encryption: transparent_data_encryption
    
    # Monitoring (comprehensive)
    security_monitoring:
      intrusion_detection: enterprise
      anomaly_detection: ml_enhanced
      threat_intelligence: premium
      incident_response: automated_enterprise
      siem_integration: true
      
      # Security analytics
      user_behavior_analytics: true
      threat_hunting: true
      forensic_logging: true

# Container Security Configuration
container_security:
  # Base image requirements
  base_images:
    allowed_registries:
      - "docker.io"
      - "gcr.io"
      - "ghcr.io"
    
    # Security requirements
    requirements:
      - distroless_preferred
      - minimal_packages
      - no_root_user
      - regular_updates
    
    # Scanning requirements
    scanning:
      vulnerability_scan: mandatory
      malware_scan: true
      license_scan: true
      compliance_scan: true
  
  # Runtime security
  runtime_security:
    # Container isolation
    isolation:
      user_namespaces: true
      seccomp_profile: runtime/default
      apparmor_profile: docker-default
    
    # Resource limits
    resource_limits:
      enforce_limits: true
      no_privileged_containers: true
      read_only_root_filesystem: true
      drop_capabilities: all_unnecessary
    
    # Network security
    network_isolation: true
    network_policies: strict

# Secrets Management Configuration
secrets_management:
  # Storage requirements
  storage:
    encryption: mandatory
    rotation: automatic
    versioning: enabled
    audit_logging: comprehensive
  
  # Access control
  access_control:
    principle: least_privilege
    approval_required: true
    time_based_access: true
    emergency_access: audited
  
  # Integration
  integrations:
    vault_systems:
      - hashicorp_vault
      - azure_key_vault
      - aws_secrets_manager
    
    # GitHub integration
    github_secrets:
      encryption: customer_managed_keys
      rotation: automated
      audit_trail: enabled

# API Security Configuration
api_security:
  # Authentication
  authentication:
    method: oauth2_pkce
    token_lifetime: 1h
    refresh_token_rotation: true
    
  # Authorization
  authorization:
    method: rbac_abac_hybrid
    fine_grained_permissions: true
    dynamic_permissions: true
  
  # Rate limiting
  rate_limiting:
    enabled: true
    per_user: true
    per_endpoint: true
    burst_protection: true
  
  # Validation
  input_validation:
    schema_validation: strict
    sanitization: comprehensive
    size_limits: enforced
    
  # Security headers
  security_headers:
    cors: restrictive
    csp: strict
    hsts: enforced

# Incident Response Configuration
incident_response:
  # Classification
  classification:
    levels:
      - L1_critical
      - L2_high
      - L3_medium
      - L4_low
  
  # Response procedures
  procedures:
    automated_response: L1_L2
    manual_response: L3_L4
    escalation_matrix: defined
    
  # Communication
  communication:
    internal_channels:
      - teams_security_channel
      - email_security_team
      - sms_oncall_security
    
    external_channels:
      - customer_notification
      - regulatory_reporting
      - law_enforcement_liaison
  
  # Recovery
  recovery:
    automated_rollback: L1_critical
    backup_restoration: automated
    service_isolation: immediate
    forensic_preservation: automatic

# Compliance Scanning Configuration
compliance_scanning:
  # Framework-specific scans
  frameworks:
    GDPR:
      data_protection_scan: true
      consent_management_check: true
      right_to_erasure_verification: true
      
    PCI_DSS:
      cardholder_data_scan: true
      network_segmentation_check: true
      access_control_verification: true
      
    SOX:
      financial_controls_check: true
      audit_trail_verification: true
      segregation_of_duties_check: true
      
    ISO27001:
      information_security_controls: true
      risk_management_verification: true
      continuous_monitoring: true

# Security Testing Configuration
security_testing:
  # SAST Configuration
  sast:
    tools:
      codeql:
        languages: [javascript, typescript, python, java]
        query_suites: [security-and-quality, security-extended]
        
      semgrep:
        rulesets: [p/security-audit, p/owasp-top-ten, p/secrets]
        custom_rules: enabled
    
    # Thresholds
    thresholds:
      critical: 0
      high: 0
      medium: 5
  
  # DAST Configuration
  dast:
    tools:
      - owasp_zap
      - nuclei
    
    scan_types:
      - baseline_scan
      - full_scan
      - api_scan
    
    # Test scenarios
    scenarios:
      - authentication_bypass
      - injection_attacks
      - broken_access_control
      - security_misconfiguration

# Monitoring and Alerting
security_monitoring:
  # Log aggregation
  logging:
    structured_logging: true
    log_retention: 365_days
    real_time_analysis: true
    
  # Alerting
  alerts:
    real_time: true
    correlation: enabled
    false_positive_reduction: ml_enhanced
    
    # Alert channels
    channels:
      immediate: [sms, teams]
      standard: [email, teams]
      informational: [email]
  
  # Metrics
  metrics:
    - failed_login_attempts
    - privilege_escalation_attempts
    - data_exfiltration_indicators
    - malware_detection_events
    - compliance_violations
    - security_scan_results

# Emergency Procedures
emergency:
  # Security incident response
  incident_response:
    isolation_procedures: automated
    communication_plan: predefined
    escalation_matrix: immediate
    
  # Emergency access
  break_glass:
    enabled: true
    approval_required: post_access
    audit_trail: comprehensive
    time_limited: 4_hours
    
  # Service continuity
  continuity:
    failover_procedures: automated
    backup_systems: hot_standby
    disaster_recovery: tested_monthly

# Training and Awareness
security_training:
  # Required training
  mandatory_training:
    - secure_coding_practices
    - incident_response
    - compliance_requirements
    - threat_awareness
    
  # Frequency
  training_frequency: quarterly
  certification_required: annual
  
  # Awareness campaigns
  awareness:
    phishing_simulations: monthly
    security_newsletters: weekly
    lunch_and_learn: monthly